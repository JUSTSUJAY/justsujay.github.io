<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Explained | Sujay Kapadnis</title>
    <link rel="icon" href="https://favicongenerator.s3.amazonaws.com/d3b1608d49d61.png" type="image/png">
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            let favicon_video_image_counter = 0;
            let favicon_video_icon_tag = document.querySelector("link[rel='icon']");
            let favicon_video_images = [
                "https://favicongenerator.s3.amazonaws.com/d3b1608d49d61.png",
                "https://favicongenerator.s3.amazonaws.com/9d6a6b0b477da.png",
                "https://favicongenerator.s3.amazonaws.com/efe1874275571.png",
                "https://favicongenerator.s3.amazonaws.com/d66a7d49c350f.png",
                "https://favicongenerator.s3.amazonaws.com/132ed4554a655.png",
                "https://favicongenerator.s3.amazonaws.com/71d365692f5da.png",
                "https://favicongenerator.s3.amazonaws.com/fff0a73a1a4ec.png",
                "https://favicongenerator.s3.amazonaws.com/3996876f6a042.png",
                "https://favicongenerator.s3.amazonaws.com/b9542cfe64df2.png",
                "https://favicongenerator.s3.amazonaws.com/a7ecf44e5c3f2.png",
                "https://favicongenerator.s3.amazonaws.com/0e9f88204ebfc.png",
                "https://favicongenerator.s3.amazonaws.com/ff8c2cadfe08f.png",
                "https://favicongenerator.s3.amazonaws.com/9fba0cdd53a1c.png",
                "https://favicongenerator.s3.amazonaws.com/4d3f965a130c2.png",
                "https://favicongenerator.s3.amazonaws.com/fad0e250aa23.png",
                "https://favicongenerator.s3.amazonaws.com/c87454ff36f67.png",
                "https://favicongenerator.s3.amazonaws.com/3d007c1f49a7a.png",
                "https://favicongenerator.s3.amazonaws.com/cadea07f55e45.png",
                "https://favicongenerator.s3.amazonaws.com/6cbf7d36c3b51.png",
                "https://favicongenerator.s3.amazonaws.com/5b5911fa713f3.png",
                "https://favicongenerator.s3.amazonaws.com/1e9f9a52f3daf.png",
                "https://favicongenerator.s3.amazonaws.com/b9347bf9e5a56.png",
                "https://favicongenerator.s3.amazonaws.com/c72196c114492.png",
                "https://favicongenerator.s3.amazonaws.com/7bfcd60bd2081.png",
                "https://favicongenerator.s3.amazonaws.com/9b344a4fd2a9e.png",
                "https://favicongenerator.s3.amazonaws.com/eead341ccbb03.png",
                "https://favicongenerator.s3.amazonaws.com/93d747cc9c06d.png",
                "https://favicongenerator.s3.amazonaws.com/2c97aca3dbc3d.png"
            ];

            async function favicon_video_to_data_url(url, callback) {
                let xhr = new XMLHttpRequest();
                xhr.onload = function () {
                    let reader = new FileReader();
                    reader.onloadend = function () {
                        callback(reader.result);
                    };
                    reader.readAsDataURL(xhr.response);
                };
                xhr.open("GET", url);
                xhr.responseType = "blob";
                xhr.send();
            }

            let favicon_video_loaded_images = [];

            favicon_video_images.map((url, idx) => {
                favicon_video_to_data_url(url, function (dataUrl) {
                    favicon_video_loaded_images[idx] = dataUrl;
                });
            });

            setInterval(function () {
                if (favicon_video_loaded_images[favicon_video_image_counter]) {
                    favicon_video_icon_tag.href = favicon_video_loaded_images[
                        favicon_video_image_counter
                    ].replace("application/octet-stream", "image/png");
                }
                if (
                    favicon_video_image_counter ==
                    favicon_video_loaded_images.length - 1
                )
                    favicon_video_image_counter = 0;
                else favicon_video_image_counter++;
            }, 100);
        });
    </script>
    <link rel="stylesheet" href="../../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <style>
        /* Blockchain visualization styles */
        .visualization-container {
            margin: 30px 0;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--primary);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .visualization-title {
            color: var(--primary);
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        /* Blockchain visualization */
        .blockchain-container {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 20px 0;
            margin-bottom: 15px;
            align-items: flex-start;
        }
        
        .block {
            width: 200px;
            min-width: 200px;
            background-color: rgba(0, 0, 0, 0.6);
            border: 2px solid var(--primary);
            border-radius: 8px;
            margin-right: 40px;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .block-header {
            padding: 10px;
            background: linear-gradient(to right, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
            border-bottom: 1px solid var(--primary);
            font-family: 'Orbitron', sans-serif;
        }
        
        .block-title {
            margin: 0;
            font-size: 0.9em;
            color: white;
        }
        
        .block-content {
            padding: 10px;
        }
        
        .block-data {
            margin-bottom: 10px;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8em;
        }
        
        .block-hash {
            background-color: rgba(0, 255, 255, 0.1);
            padding: 8px;
            border-radius: 4px;
            word-break: break-all;
            font-size: 0.7em;
            color: var(--primary);
            margin-top: 10px;
        }
        
        .block-arrow {
            position: absolute;
            top: 50%;
            right: -30px;
            width: 20px;
            height: 20px;
            border-top: 2px solid var(--primary);
            border-right: 2px solid var(--primary);
            transform: translateY(-50%) rotate(45deg);
        }
        
        /* Transaction mempool visualization */
        .mempool-container {
            height: 200px;
            border: 1px dashed var(--primary);
            position: relative;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .mempool-transaction {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--primary);
            border-radius: 4px;
            padding: 8px;
            font-size: 0.8em;
            transition: all 0.5s ease;
        }
        
        .miner-container {
            display: flex;
            justify-content: center;
            position: relative;
            height: 80px;
            margin: 20px 0;
        }
        
        .miner {
            width: 60px;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            position: relative;
        }
        
        .mining-rays {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 255, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(255, 0, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 255, 0); }
        }
        
        /* POS vs POW visualization */
        .consensus-comparison {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }
        
        .consensus-method {
            flex: 1;
            min-width: 250px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
        }
        
        .consensus-title {
            color: var(--primary);
            margin-top: 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 8px;
            font-size: 1em;
        }
        
        .consensus-visual {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin: 15px 0;
        }
        
        /* Controls for the visualizations */
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .control-btn {
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background-color: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* Mining difficulty visualization */
        .difficulty-slider-container {
            margin: 20px 0;
        }
        
        .difficulty-slider {
            width: 100%;
            margin: 10px 0;
            -webkit-appearance: none;
            appearance: none;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right, #00ffff, #ff00ff);
            outline: none;
        }
        
        .difficulty-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            border: 2px solid var(--primary);
        }
        
        .hash-rate-display {
            font-family: 'Roboto Mono', monospace;
            text-align: center;
            padding: 10px;
            margin-top: 10px;
            color: var(--primary);
        }
        
        .hash-calculation {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9em;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 4px;
            margin: 10px 0;
        }
        
        /* Custom tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--primary);
            cursor: help;
            color: var(--primary);
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0, 0, 0, 0.9);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8em;
            border: 1px solid var(--primary);
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="quantum-field"></div>
    <div id="app">
        <header>
            <div class="logo">
                <a href="../../">Sujay Kapadnis</a>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="../../">Home</a></li>
                    <li><a href="../../projects/">Projects</a></li>
                    <li><a href="../../resume/">Resume</a></li>
                    <li><a href="../../blogs/">Blog</a></li>
                    <li><a href="../../index.html#contact">Contact</a></li>
                </ul>
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </nav>
            
        </header>
        <main class="container blog-post">
            <h1 class="page-title quantum-title">Blockchain Explained</h1>
            <div class="post-meta quantum-meta">
                <span class="post-date">May 02, 2025</span>
                <span class="post-author">by Sujay Kapadnis</span>
            </div>
            <article class="post-content">
                <h2>The Basics: Blockchain Structure and Nodes</h2>

                <!-- Blockchain Structure Visualization -->
                <div class="visualization-container">
                    <div class="visualization-title">Blockchain: A Chain of Blocks</div>
                    <p>Each block contains transaction data and links to the previous block via its hash, forming an immutable chain.</p>
                    <div class="blockchain-container" id="blockchainDemo">
                        <!-- Blocks will be added here via JavaScript -->
                    </div>
                    <div class="controls">
                        <button class="control-btn" id="addBlockBtn">Add New Block</button>
                        <button class="control-btn" id="resetBlockchainBtn">Reset Chain</button>
                    </div>
                </div>

                <ul>
                    <li>Blockchain is a decentralized system where transaction records (in blocks) are stored across a distributed network of computers (nodes).</li>
                    <li>The security comes from this distribution - for a record to be accepted, it must match across the network. Any mismatch would indeed flag potential fraud.</li>
                    <li>Once blocks are added, they&#39;re effectively immutable - only new blocks can be added on top, creating the &quot;chain&quot; effect.</li>
                </ul>
                
                <h2>Transactions and the Mempool</h2>

                <!-- Mempool Visualization -->
                <div class="visualization-container">
                    <div class="visualization-title">Transaction Mempool</div>
                    <p>Unconfirmed transactions wait in the mempool until miners include them in a block.</p>
                    <div class="mempool-container" id="mempoolContainer">
                        <!-- Transactions will be added here via JavaScript -->
                    </div>
                    <div class="controls">
                        <button class="control-btn" id="addTxBtn">Add Transaction</button>
                        <button class="control-btn" id="processTxBtn">Process Transactions</button>
                    </div>
                </div>

                <ul>
                    <li>Transactions are first <em>validated</em> by each node that receives it before entering the mempool.</li>
                    <li>This validation includes checking digital signatures, ensuring inputs exist, and verifying the sender has sufficient balance.</li>
                    <li>The mempool isn&#39;t a single central location but rather exists independently on each node - nodes share information about which transactions they have in their mempools.</li>
                </ul>
                
                <h2>Block Formation and Mining</h2>
                
                <!-- Mining Visualization -->
                <div class="visualization-container">
                    <div class="visualization-title">Mining Process</div>
                    <p>Miners compete to find a valid hash by repeatedly changing the nonce value.</p>
                    <div class="mining-visualization">
                        <div class="hash-calculation" id="hashCalculation">
                            Hash: calculating...
                        </div>
                        <div class="miner-container">
                            <div class="miner" id="minerAnimation">
                                <div class="mining-rays"></div>
                                ⛏️
                            </div>
                        </div>
                        <div class="hash-rate-display" id="hashRateDisplay">
                            Mining at 0 hashes/second
                        </div>
                    </div>
                    <div class="difficulty-slider-container">
                        <label for="difficultySlider">Adjust Mining Difficulty:</label>
                        <input type="range" min="1" max="5" value="3" class="difficulty-slider" id="difficultySlider">
                    </div>
                    <div class="controls">
                        <button class="control-btn" id="startMiningBtn">Start Mining</button>
                        <button class="control-btn" id="stopMiningBtn">Stop Mining</button>
                    </div>
                </div>

                <ul>
                    <li>Miners typically choose transactions based on &quot;fee density&quot; (fee divided by transaction size) rather than just highest fee.</li>
                    <li>This maximizes their profit per block space used.</li>
                    <li>About the puzzle: The &quot;target&quot; isn&#39;t actually shared directly between blocks. Each block contains its own difficulty target.</li>
                    <li>The actual process is:<ol>
                        <li>Miner takes transactions from mempool</li>
                        <li>Creates a candidate block with those transactions</li>
                        <li>Adds a coinbase transaction (their reward) </li>
                        <li>Calculates the Merkle root of all transactions</li>
                        <li>Assembles the block header with the previous block hash, Merkle root, timestamp, bits, and nonce</li>
                        <li>Repeatedly changes the nonce (and sometimes timestamp or transaction order) to find a hash below the target</li>
                    </ol>
                    </li>
                </ul>

                <h2>Mining Rewards and Incentives</h2>
                <ul>
                    <li>Miners receive newly created coins (the &quot;block subsidy&quot;) plus all transaction fees</li>
                    <li>In Bitcoin, this block subsidy started at 50 BTC and halves approximately every 4 years</li>
                    <li>Currently (May 2025), the block subsidy is 3.125 BTC per block</li>
                    <li>This controlled issuance is how new coins enter circulation</li>
                </ul>
                <h2>Difficulty Adjustment</h2>
                <ul>
                    <li>The adjustment aims to keep block times at approximately 10 minutes regardless of how much mining power joins or leaves the network</li>
                    <li>If more miners join, blocks would be found faster than 10 minutes, so difficulty increases</li>
                    <li>If miners leave, blocks would be found slower than 10 minutes, so difficulty decreases</li>
                    <li>This self-regulating mechanism maintains consistent block timing regardless of network hashpower</li>
                </ul>
                <h2>Proof of Stake Clarification</h2>
                
                <!-- Consensus Comparison Visualization -->
                <div class="visualization-container">
                    <div class="visualization-title">Consensus Mechanisms Comparison</div>
                    <p>Proof of Work (PoW) relies on computational power, while Proof of Stake (PoS) relies on economic stake.</p>
                    <div class="consensus-comparison">
                        <div class="consensus-method">
                            <h3 class="consensus-title">Proof of Work (PoW)</h3>
                            <div class="consensus-visual" id="powVisual">
                                <!-- PoW animation will be added here -->
                            </div>
                            <p>Miners compete to solve a computational puzzle, consuming energy but providing strong security.</p>
                        </div>
                        <div class="consensus-method">
                            <h3 class="consensus-title">Proof of Stake (PoS)</h3>
                            <div class="consensus-visual" id="posVisual">
                                <!-- PoS animation will be added here -->
                            </div>
                            <p>Validators are selected based on the amount of cryptocurrency they stake, offering energy efficiency.</p>
                        </div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" id="toggleConsensusBtn">Toggle Animation</button>
                    </div>
                </div>

                <ul>
                    <li>In PoS, validators (not miners) are selected to create blocks based partly on how many coins they&#39;ve staked</li>
                    <li>They don&#39;t exactly &quot;put stake on letting their block pass first&quot;</li>
                    <li>Instead, the protocol randomly selects validators, with higher stake giving a proportionally higher chance of selection</li>
                    <li>Unlike PoW, there&#39;s no computational puzzle to solve - validation is based on economic stake in the system</li>
                </ul>
                <h2>Blockchain Finality</h2>
                <ul>
                    <li>One concept to be mentioned is &quot;finality&quot;:<ul>
                    <li>In Bitcoin and most PoW systems, blocks are never 100% final</li>
                    <li>Each new block built on top adds &quot;confirmation&quot; and makes reversal exponentially more difficult</li>
                    <li>By convention, most Bitcoin users consider 6 confirmations (blocks built on top) to be effectively final</li>
                    <li>This probabilistic finality differs from some other consensus mechanisms that offer absolute finality</li>
                    </ul>
                    </li>
                </ul>

            </article>
        </main>
        <footer>
            <div class="container">
                <p>&copy; 2025 Sujay Kapadnis. All rights reserved.</p>
            </div>
        </footer>
    </div>
    <script>
        // Quantum field animation
        const quantumField = document.getElementById('quantum-field');
        
        for (let i = 0; i < 50; i++) {
            createParticle();
        }
    
        function createParticle() {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + 'vw';
            particle.style.top = Math.random() * 100 + 'vh';
            quantumField.appendChild(particle);
            animateParticle(particle);
        }
    
        function animateParticle(particle) {
            const duration = Math.random() * 3000 + 2000;
            const keyframes = [
                { transform: 'translate(0, 0)' },
                { transform: `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px)` }
            ];
            const animation = particle.animate(keyframes, {
                duration: duration,
                iterations: Infinity,
                direction: 'alternate',
                easing: 'ease-in-out'
            });
    
            animation.onfinish = () => animateParticle(particle);
        }
    
        // Mobile menu toggle
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');
    
        hamburger.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });

        // ===============================
        // Blockchain Visualization Scripts
        // ===============================
        
        // ---------------
        // Blockchain Demo
        // ---------------
        const blockchainDemo = document.getElementById('blockchainDemo');
        const addBlockBtn = document.getElementById('addBlockBtn');
        const resetBlockchainBtn = document.getElementById('resetBlockchainBtn');
        
        let blockchain = [];
        const GENESIS_HASH = '0000000000000000000000000000000000000000000000000000000000000000';
        
        // Generate a simple hash
        function simpleHash(data, previousHash) {
            // In a real blockchain, this would be a cryptographic hash function
            let hash = '';
            const characters = '0123456789abcdef';
            const dataString = data + previousHash + Date.now();
            
            // Create a simple hash of 64 characters
            for (let i = 0; i < 64; i++) {
                hash += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            
            return hash;
        }
        
        // Create a new block element
        function createBlockElement(block, index) {
            const blockElement = document.createElement('div');
            blockElement.className = 'block';
            
            const header = document.createElement('div');
            header.className = 'block-header';
            header.innerHTML = `<h3 class="block-title">Block #${index}</h3>`;
            
            const content = document.createElement('div');
            content.className = 'block-content';
            
            const timestamp = document.createElement('div');
            timestamp.className = 'block-data';
            timestamp.textContent = `Timestamp: ${new Date(block.timestamp).toLocaleTimeString()}`;
            
            const data = document.createElement('div');
            data.className = 'block-data';
            data.textContent = `Data: ${block.data}`;
            
            const hash = document.createElement('div');
            hash.className = 'block-hash';
            hash.textContent = block.hash.substr(0, 20) + '...';
            hash.title = block.hash;
            
            content.appendChild(timestamp);
            content.appendChild(data);
            content.appendChild(hash);
            
            blockElement.appendChild(header);
            blockElement.appendChild(content);
            
            // Add arrow if not the last block
            if (index < blockchain.length - 1) {
                const arrow = document.createElement('div');
                arrow.className = 'block-arrow';
                blockElement.appendChild(arrow);
            }
            
            return blockElement;
        }
        
        // Render the blockchain
        function renderBlockchain() {
            blockchainDemo.innerHTML = '';
            
            blockchain.forEach((block, index) => {
                const blockElement = createBlockElement(block, index);
                blockchainDemo.appendChild(blockElement);
            });
        }
        
        // Add a new block
        function addBlock() {
            const previousHash = blockchain.length > 0 ? blockchain[blockchain.length - 1].hash : GENESIS_HASH;
            const data = `Transaction data ${blockchain.length}`;
            const timestamp = Date.now();
            const hash = simpleHash(data, previousHash);
            
            const newBlock = {
                data,
                previousHash,
                timestamp,
                hash
            };
            
            blockchain.push(newBlock);
            renderBlockchain();
        }
        
        // Initialize blockchain with genesis block
        function initBlockchain() {
            blockchain = [];
            addBlock();
        }
        
        // Event listeners
        addBlockBtn.addEventListener('click', addBlock);
        resetBlockchainBtn.addEventListener('click', initBlockchain);
        
        // Initialize the blockchain visualization
        initBlockchain();
        
        // ---------------
        // Mempool Visualization
        // ---------------
        const mempoolContainer = document.getElementById('mempoolContainer');
        const addTxBtn = document.getElementById('addTxBtn');
        const processTxBtn = document.getElementById('processTxBtn');
        
        const transactions = [];
        
        // Create a transaction element
        function createTransactionElement(tx) {
            const txElement = document.createElement('div');
            txElement.className = 'mempool-transaction';
            txElement.textContent = `Tx: ${tx.id.substr(0, 8)}...`;
            
            // Random position within the mempool
            const left = Math.random() * 80 + 10;
            const top = Math.random() * 70 + 10;
            
            txElement.style.left = `${left}%`;
            txElement.style.top = `${top}%`;
            
            return txElement;
        }
        
        // Add a transaction to the mempool
        function addTransaction() {
            const txId = Math.random().toString(16).substr(2);
            const tx = {
                id: txId,
                fee: Math.floor(Math.random() * 100),
                size: Math.floor(Math.random() * 1000)
            };
            
            transactions.push(tx);
            
            const txElement = createTransactionElement(tx);
            mempoolContainer.appendChild(txElement);
        }
        
        // Process transactions (simulate adding to a block)
        function processTransactions() {
            // Animation: transactions moving out of the mempool
            const txElements = mempoolContainer.querySelectorAll('.mempool-transaction');
            
            txElements.forEach((tx, i) => {
                // Stagger the movement
                setTimeout(() => {
                    tx.style.transform = 'translateY(100%)';
                    tx.style.opacity = '0';
                    
                    // Remove the element after animation
                    setTimeout(() => {
                        tx.remove();
                    }, 500);
                }, i * 100);
            });
            
            // Clear the transactions array
            transactions.length = 0;
        }
        
        // Event listeners
        addTxBtn.addEventListener('click', addTransaction);
        processTxBtn.addEventListener('click', processTransactions);
        
        // Add a few initial transactions
        for (let i = 0; i < 5; i++) {
            addTransaction();
        }
        
        // ---------------
        // Mining Visualization
        // ---------------
        const hashCalculation = document.getElementById('hashCalculation');
        const minerAnimation = document.getElementById('minerAnimation');
        const hashRateDisplay = document.getElementById('hashRateDisplay');
        const difficultySlider = document.getElementById('difficultySlider');
        const startMiningBtn = document.getElementById('startMiningBtn');
        const stopMiningBtn = document.getElementById('stopMiningBtn');
        
        let miningInterval;
        let hashCount = 0;
        let startTime;
        let targetPrefix = '0'.repeat(3); // Initial difficulty based on slider default value
        
        // Update difficulty based on slider
        function updateDifficulty() {
            const level = difficultySlider.value;
            targetPrefix = '0'.repeat(level);
            hashCalculation.textContent = `Target: Hash must start with ${targetPrefix}`;
            
            // Update mining speed if currently mining
            if (miningInterval) {
                clearInterval(miningInterval);
                const rate = 6 - difficultySlider.value; // Higher difficulty = slower rate
                miningInterval = setInterval(mine, rate * 50);
            }
        }
        
        // Generate a random hash
        function generateHash() {
            const characters = '0123456789abcdef';
            let hash = '';
            
            for (let i = 0; i < 64; i++) {
                hash += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            
            return hash;
        }
        
        // Check if a hash meets the difficulty requirement
        function isValidHash(hash) {
            return hash.startsWith(targetPrefix);
        }
        
        // Update hash rate display
        function updateHashRate() {
            const now = Date.now();
            const timeElapsed = (now - startTime) / 1000; // in seconds
            const rate = Math.floor(hashCount / timeElapsed);
            
            hashRateDisplay.textContent = `Mining at ${rate} hashes/second`;
        }
        
        // Mine blocks
        function mine() {
            hashCount++;
            
            if (hashCount % 10 === 0) {
                updateHashRate();
            }
            
            const hash = generateHash();
            hashCalculation.textContent = `Hash: ${hash.substr(0, 16)}...`;
            
            // Check if hash is valid
            if (isValidHash(hash)) {
                // Found a valid hash
                stopMining();
                hashCalculation.textContent = `FOUND VALID HASH: ${hash.substr(0, 16)}...`;
                hashCalculation.style.color = '#00ffff';
                
                // Add the mined block to the blockchain visualization
                addBlock();
                
                // Highlight miner animation
                minerAnimation.style.borderColor = '#00ffff';
                setTimeout(() => {
                    minerAnimation.style.borderColor = '';
                    hashCalculation.style.color = '';
                }, 2000);
            }
        }
        
        // Start mining
        function startMining() {
            if (miningInterval) return;
            
            startTime = Date.now();
            hashCount = 0;
            
            // Reset hash display
            hashCalculation.textContent = 'Mining...';
            
            // Start animation
            minerAnimation.classList.add('mining');
            
            // Start mining at a rate determined by difficulty
            const rate = 6 - difficultySlider.value; // Higher difficulty = slower rate
            miningInterval = setInterval(mine, rate * 50);
        }
        
        // Stop mining
        function stopMining() {
            if (!miningInterval) return;
            
            clearInterval(miningInterval);
            miningInterval = null;
            minerAnimation.classList.remove('mining');
        }
        
        // Event listeners
        difficultySlider.addEventListener('input', updateDifficulty);
        startMiningBtn.addEventListener('click', startMining);
        stopMiningBtn.addEventListener('click', stopMining);
        
        // Initialize with current slider value
        updateDifficulty();
        
        // ---------------
        // Consensus Comparison
        // ---------------
        const powVisual = document.getElementById('powVisual');
        const posVisual = document.getElementById('posVisual');
        const toggleConsensusBtn = document.getElementById('toggleConsensusBtn');
        
        let consensusAnimating = false;
        
        // Create PoW visualization
        function createPowVisualization() {
            powVisual.innerHTML = `
                <div style="position: absolute; width: 40px; height: 40px; background: rgba(0,255,255,0.2); border: 2px solid var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    ⛏️
                </div>
                <div style="position: absolute; width: 20px; height: 20px; background: var(--primary); border-radius: 50%; left: 70%; top: 30%;">
                    💻
                </div>
                <div style="position: absolute; width: 20px; height: 20px; background: var(--primary); border-radius: 50%; left: 20%; top: 70%;">
                    💻
                </div>
            `;
        }
        
        // Create PoS visualization
        function createPosVisualization() {
            posVisual.innerHTML = `
                <div style="position: absolute; width: 50px; height: 50px; background: rgba(255,0,255,0.2); border: 2px solid var(--secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    💰
                </div>
                <div style="position: absolute; width: 30px; height: 30px; background: rgba(255,0,255,0.1); border: 1px solid var(--secondary); border-radius: 50%; left: 60%; top: 20%;">
                    💰
                </div>
                <div style="position: absolute; width: 20px; height: 20px; background: rgba(255,0,255,0.1); border: 1px solid var(--secondary); border-radius: 50%; left: 20%; top: 60%;">
                    💰
                </div>
            `;
        }
        
        // Animate PoW mining process
        function animatePow() {
            // Miners working hard with CPUs
            const miner = powVisual.querySelector('div');
            miner.animate([
                { transform: 'rotate(-5deg)' },
                { transform: 'rotate(5deg)' }
            ], {
                duration: 200,
                iterations: 5
            });
        }
        
        // Animate PoS validation process
        function animatePos() {
            // Validators staking their coins
            const stakes = posVisual.querySelectorAll('div');
            
            stakes.forEach((stake, i) => {
                setTimeout(() => {
                    stake.animate([
                        { transform: 'scale(1)' },
                        { transform: 'scale(1.2)' },
                        { transform: 'scale(1)' }
                    ], {
                        duration: 500,
                        iterations: 1
                    });
                }, i * 300);
            });
        }
        
        // Toggle consensus visualization animations
        function toggleConsensusAnimation() {
            if (consensusAnimating) {
                consensusAnimating = false;
                toggleConsensusBtn.textContent = 'Start Animation';
            } else {
                consensusAnimating = true;
                toggleConsensusBtn.textContent = 'Stop Animation';
                
                // Start animation loop
                animateConsensus();
            }
        }
        
        function animateConsensus() {
            if (!consensusAnimating) return;
            
            animatePow();
            setTimeout(animatePos, 1000);
            
            setTimeout(animateConsensus, 2000);
        }
        
        // Initialize consensus visualizations
        createPowVisualization();
        createPosVisualization();
        
        // Event listener
        toggleConsensusBtn.addEventListener('click', toggleConsensusAnimation);
    </script>
</body>
</html>
